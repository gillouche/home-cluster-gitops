apiVersion: batch/v1
kind: CronJob
metadata:
  name: daily-summary
  namespace: monitoring
spec:
  schedule: "0 8 * * *" # 8 AM daily
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: summary
            image: python:3.14-slim
            command: ["python", "/app/summary.py"]
            env:
            - name: DISCORD_WEBHOOK_URL
              value: /etc/secrets/daily-summary
            volumeMounts:
            - name: script
              mountPath: /app/summary.py
              subPath: summary.py
            - name: secrets
              mountPath: /etc/secrets
              readOnly: true
          restartPolicy: OnFailure
          volumes:
          - name: script
            configMap:
              name: daily-summary-script
          - name: secrets
            secret:
              secretName: monitoring-discord-webhooks
