apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: shared-db
  namespace: database
spec:
  instances: 3
  
  # Pin Postgres Version
  imageName: ghcr.io/cloudnative-pg/postgresql:16.1
  
  # Storage
  storage:
    size: 50Gi
    storageClass: longhorn

  # Bootstrap (Init)
  bootstrap:
    initdb:
      database: sonarqube
      owner: sonarqube

  managed:
    roles:
    - name: sonarqube
      ensure: present
      login: true
      superuser: false
      createdb: true
      connectionLimit: -1
      inherit: true
    - name: polaris
      ensure: present
      login: true
      createdb: true 
      connectionLimit: -1
      inherit: true
  
  inheritedMetadata:
    annotations:
      reflector.v1.k8s.emberstack.com/reflection-allowed: "true"
      reflector.v1.k8s.emberstack.com/reflection-auto-enabled: "true"
      reflector.v1.k8s.emberstack.com/reflection-allowed-namespaces: "sonarqube,data-lake,data-lake"
